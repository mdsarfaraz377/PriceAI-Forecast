<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price AI - Professional Forecast</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #020617;
            color: #f8fafc;
        }

        .glass-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.4) 0%, rgba(15, 23, 42, 0.6) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .gradient-brand {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .input-pill:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar {
            width: 5px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }
    </style>
</head>

<body
    class="min-h-screen bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-slate-950 to-black py-12 px-4 selection:bg-indigo-500/30">

    <div class="max-w-6xl mx-auto space-y-10">
        <!-- Header -->
        <header class="text-center space-y-4">
            <div
                class="inline-flex items-center px-3 py-1 rounded-full bg-indigo-500/10 border border-indigo-500/20 text-indigo-400 text-sm font-medium mb-4 animate-pulse">
                AI Engine Active
            </div>
            <h1 class="text-6xl font-black tracking-tighter">
                <span class="gradient-brand">Price Intelligence</span>
            </h1>
            <p class="text-slate-400 text-xl font-light max-w-2xl mx-auto">
                Predicting market shifts with high-fidelity SARIMA modeling.
                Visualize historical context alongside future projections.
            </p>
        </header>

        <!-- Main Dashboard -->
        <main class="grid grid-cols-1 lg:grid-cols-4 gap-8">

            <!-- Controls Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <div class="glass-card rounded-3xl p-6 border border-white/5">
                    <h3 class="text-lg font-bold mb-4 text-white flex items-center">
                        <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
                            </path>
                        </svg>
                        Parameters
                    </h3>

                    <div class="space-y-4">
                        <div>
                            <label
                                class="block text-xs font-semibold uppercase tracking-widest text-slate-500 mb-2">Forecast
                                Horizon</label>
                            <div class="relative">
                                <input type="number" id="months-input" min="1" max="60" value="12"
                                    class="w-full bg-slate-950/50 border border-slate-800 rounded-2xl px-5 py-3 text-white font-bold input-pill transition-all outline-none">
                                <span class="absolute right-4 top-3.5 text-slate-600 text-sm">Months</span>
                            </div>
                        </div>

                        <div>
                            <input type="range" id="months-slider" min="1" max="60" value="12"
                                class="w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-indigo-500">
                        </div>

                        <div id="status-indicator" class="flex items-center space-x-2 pt-4">
                            <div class="flex space-x-1">
                                <div class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce"></div>
                                <div
                                    class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce [animation-delay:-0.15s]">
                                </div>
                                <div
                                    class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce [animation-delay:-0.3s]">
                                </div>
                            </div>
                            <span class="text-xs font-bold text-indigo-400 uppercase tracking-widest">Processing</span>
                        </div>
                    </div>
                </div>

                <!-- Stats Summary -->
                <div class="glass-card rounded-3xl p-6 space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-500 text-sm">Target Peak</span>
                        <span id="peak-val" class="text-white font-bold font-mono">--</span>
                    </div>
                    <div class="flex justify-between items-center border-t border-white/5 pt-4">
                        <span class="text-slate-500 text-sm">Volatility Score</span>
                        <span class="text-emerald-500 font-bold">Stable</span>
                    </div>
                </div>
            </div>

            <!-- Graph Area -->
            <div class="lg:col-span-3 space-y-6">
                <div class="glass-card rounded-3xl p-8">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h2 class="text-2xl font-bold text-white">Market Trajectory</h2>
                            <p class="text-slate-500 text-sm">Historical variance (24m) vs Algorithmic prediction</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center text-xs font-bold uppercase text-slate-400">
                                <span class="w-3 h-3 bg-slate-600 rounded-full mr-2"></span> Past
                            </div>
                            <div class="flex items-center text-xs font-bold uppercase text-indigo-400">
                                <span
                                    class="w-3 h-3 bg-indigo-500 rounded-full mr-2 shadow-[0_0_10px_rgba(99,102,241,0.5)]"></span>
                                Forecast
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>

                <!-- Data Feed -->
                <div class="glass-card rounded-3xl overflow-hidden">
                    <div class="p-6 border-b border-white/5 bg-white/5">
                        <h3 class="font-bold text-white">Full Forecast Table</h3>
                    </div>
                    <div class="max-h-64 overflow-y-auto custom-scroll">
                        <table class="w-full text-left">
                            <thead
                                class="sticky top-0 bg-slate-900 text-slate-500 text-xs font-bold uppercase tracking-widest">
                                <tr>
                                    <th class="px-8 py-4">Projection Date</th>
                                    <th class="px-8 py-4">Estimated Value</th>
                                    <th class="px-8 py-4 text-center">Confidence Range</th>
                                </tr>
                            </thead>
                            <tbody id="table-feed" class="divide-y divide-white/5">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <footer class="text-center py-8 border-t border-white/5">
            <p class="text-slate-600 text-xs font-medium uppercase tracking-[0.3em]">
                &copy; 2025 Neural Assets Lab &bull; Experimental Prediction Platform
            </p>
        </footer>
    </div>

    <script>
        let myChart = null;
        const inputNum = document.getElementById('months-input');
        const inputSlider = document.getElementById('months-slider');
        const status = document.getElementById('status-indicator');
        const peakDisplay = document.getElementById('peak-val');
        const tableFeed = document.getElementById('table-feed');

        function setupChart(histLabels, histData, foreLabels, foreData, lower, upper) {
            const ctx = document.getElementById('mainChart').getContext('2d');

            // Combine labels for continuous X-axis
            const allLabels = [...histLabels, ...foreLabels];

            // Align data sets (historical data ends where forecast starts)
            const historicalSet = histData.map(v => v);
            const padding = histData.length - 1;

            // Setup Forecast array with nulls for the historical section
            const forecastSet = new Array(padding).fill(null).concat(foreData);
            const lowerSet = new Array(padding).fill(null).concat(lower);
            const upperSet = new Array(padding).fill(null).concat(upper);

            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: allLabels,
                    datasets: [
                        {
                            label: 'Historical',
                            data: historicalSet,
                            borderColor: '#334155',
                            borderWidth: 2,
                            pointRadius: 0,
                            borderDash: [5, 5],
                            tension: 0.3
                        },
                        {
                            label: 'Forecast',
                            data: forecastSet,
                            borderColor: '#6366f1',
                            borderWidth: 4,
                            pointRadius: 4,
                            pointBackgroundColor: '#6366f1',
                            pointHoverRadius: 8,
                            shadowBlur: 15,
                            shadowColor: 'rgba(99, 102, 241, 0.4)',
                            tension: 0.4
                        },
                        {
                            label: 'Confidence Interval',
                            data: upperSet,
                            borderColor: 'transparent',
                            backgroundColor: 'rgba(99, 102, 241, 0.05)',
                            fill: false,
                            pointRadius: 0,
                            tension: 0.4
                        },
                        {
                            label: 'Confidence Interval Fill',
                            data: lowerSet,
                            borderColor: 'transparent',
                            backgroundColor: 'rgba(99, 102, 241, 0.05)',
                            fill: '-1',
                            pointRadius: 0,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.03)' },
                            ticks: { color: '#64748b', font: { family: 'Plus Jakarta Sans', size: 10 } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#64748b',
                                font: { size: 10 },
                                maxRotation: 45,
                                autoSkip: true,
                                maxTicksLimit: 12
                            }
                        }
                    }
                }
            });
        }

        async function refreshData() {
            const val = inputNum.value;
            status.classList.remove('invisible');

            try {
                const response = await fetch(`/?months=${val}&ajax=1`);
                const data = await response.json();

                if (response.ok) {
                    setupChart(data.hist_dates, data.hist_prices, data.dates, data.prices, data.lower_ci, data.upper_ci);

                    // Update Table
                    tableFeed.innerHTML = '';
                    data.dates.forEach((d, i) => {
                        const tr = document.createElement('tr');
                        tr.className = "hover:bg-white/5 transition-colors group";
                        tr.innerHTML = `
                            <td class="px-8 py-4 text-sm font-medium text-slate-300 font-mono">${d}</td>
                            <td class="px-8 py-4 text-lg font-bold text-indigo-400 font-mono italic">¥${data.prices[i]}</td>
                            <td class="px-8 py-4 text-center">
                                <span class="text-[10px] text-slate-500 font-bold bg-slate-900 border border-slate-800 rounded px-2 py-1">
                                    ${data.lower_ci[i]} - ${data.upper_ci[i]}
                                </span>
                            </td>
                        `;
                        tableFeed.appendChild(tr);
                    });

                    // Update Peak
                    peakDisplay.innerText = `¥${Math.max(...data.prices)}`;
                }
            } catch (e) {
                console.error("Fetch error", e);
            } finally {
                status.classList.add('invisible');
            }
        }

        // Synchronize inputs
        inputNum.oninput = () => {
            inputSlider.value = inputNum.value;
            debounceRefresh();
        };
        inputSlider.oninput = () => {
            inputNum.value = inputSlider.value;
            debounceRefresh();
        };

        let timer;
        function debounceRefresh() {
            clearTimeout(timer);
            timer = setTimeout(refreshData, 300);
        }

        window.onload = refreshData;
    </script>
</body>

</html>